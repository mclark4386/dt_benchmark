<div class="page-header">
  <h1>Pages</h1>
</div>
<ul class="list-unstyled list-inline">
  <li><a href="<%= newPagesPath() %>" class="btn btn-primary">Create New Page</a></li>
</ul>

<table class="table table-striped">
  <thead>
  <th>Title</th>
    <th>Slug</th>
    <th>&nbsp;</th>
  </thead>
  <tbody>
    <%= for (page) in pages { %>
      <tr>
      <td><%= page.Title %></td>
        <td><%= page.Slug %></td>
        <td>
          <div class="pull-right">
            <a href="<%= pagePath({ page_id: page.ID }) %>" class="btn btn-info">View</a>
            <a href="<%= editPagePath({ page_id: page.ID }) %>" class="btn btn-warning">Edit</a>
            <a href="<%= pagePath({ page_id: page.ID }) %>" data-method="DELETE" data-confirm="Are you sure?" class="btn btn-danger">Destroy</a>
            <a href="/pages/<%=page.Slug%>" class="btn btn-success export-btn" data-mime-type="application/json" data-page="<%=page.Slug%>">Export</a>
          </div>
        </td>
      </tr>
    <% } %>
  </tbody>
</table>

<div class="text-center">
  <%= paginator(pagination) %>
</div>

<script>
 $(() => {
   $('.export-btn').on('click', (ev) => {
       ev.preventDefault();
       var slug = $(ev.target).data('page');
       console.log(slug);
       var mime = $(ev.target).data('mime-type');
       console.log(mime);
       $.ajax({
           accepts: {text: mime},
           processData: false,
           dataType: 'text',
           success: (data) => {
               console.log(data);
               var uri = 'data:'+mime+';charset=UTF-8,'+encodeURIComponent(data);
               console.log(uri);
               //               window.location = uri;
               window.FileSaver.saveAs(new File([data], slug+".json", {type: mime+';charset=UTF-8'}));
           }
       });
       return false;
   });
 });
</script>
